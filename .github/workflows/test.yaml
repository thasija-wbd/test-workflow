name: test-workflow

on:
  push:
    branches:
      - main
    paths:
      - "job-definitions/**"

jobs:
  validate:
    name: "find changed yaml file content"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          ref: ${{ github.head_ref }}
          fetch-depth: 2

      - name: Detect now yaml file changes
        id: detect-now-yaml-changes
        run: |
          EXCLUDE_AUTO_COMMIT_CHANGES=false
          CHANGED_FILES=$(git diff --name-only HEAD^ HEAD -- job-definitions/)
          CHANGED_FILES_COUNT=$(echo "$CHANGED_FILES" | wc -l)
          echo "Changed files:"
          echo "$CHANGED_FILES"
          # Set the list of changed files as an output variable
          echo "::set-output name=changed_files::$CHANGED_FILES"

      - name: Convert yaml to json
        id: convert-yaml-to-json
        run: |
          for FILE in ${{ steps.detect-now-yaml-changes.outputs.changed_files }}; do
            echo "Converting $FILE to JSON..."
            json_content=$(your_conversion_command "$FILE")  # Replace with your actual conversion command
            echo "Converted JSON content:"
            echo "$json_content"
            # You might want to save or use the converted content here
          done
