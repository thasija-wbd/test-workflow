
        WITH 
        base_result AS(
          SELECT 
            DATEDIFF(minute,LINE_ITEM_USAGE_START_DATE,LINE_ITEM_USAGE_END_DATE) as dd,
            (dd /60) as hours_inv-1-1olved,LINE_ITEM_PRODUCT_CODE,LINE_ITEM_BLENDED_COST,
            (LINE_ITEM_BLENDED_COST / hours_involved) as hourly_cost,
            IFNULL(RESOURCE_TAGS_USER_OMD_BUSINESS_SERVICE,'_unknown') as business_service,
            IFNULL(RESOURCE_TAGS_USER_OMD_COMPONENT,'_unknown') as component,
            IFNULL(RESOURCE_TAGS_USER_OMD_SERVICE,'_unknown') as service,LINE_ITEM_USAGE_ACCOUNT_ID,
            IFNULL(PRODUCT_FROM_REGION_CODE,'global') as region 
            FROM BOLT_OMD_METRICS_DEV.DATA_PLATFORM_GOLD.AWS_CUR_FILE_USAGE 
            WHERE {{environment_filter}} AND {{time_filter}}) 
            select SUM(HOURLY_COST) as value,LINE_ITEM_PRODUCT_CODE,BUSINESS_SERVICE,COMPONENT,SERVICE,LINE_ITEM_USAGE_ACCOUNT_ID,REGION from base_result GROUP BY (LINE_ITEM_PRODUCT_CODE,BUSINESS_SERVICE,COMPONENT,SERVICE,LINE_ITEM_USAGE_ACCOUNT_ID,REGION)
  calculationQuery: |
    SELECT `VALUE` as measure,LINE_ITEM_PRODUCT_CODE as awsServiceName,BUSINESS_SERVICE as omdBusinessService,COMPONENT as omdComponent,SERVICE as omdService, LINE_ITEM_USAGE_ACCOUNT_ID as awsAccountId,REGION as awsRegion,'any' as omdMarket,'any' as omdTenant FROM ? as gc
